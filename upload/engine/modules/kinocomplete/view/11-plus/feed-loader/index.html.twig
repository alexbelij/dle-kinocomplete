{# feed-loader/index.html.twig #}

{% set errors = diagnostics.getErrors() %}
{% set warnings = diagnostics.getWarnings() %}

{% extends "base.html.twig" %}

{% block header %}

  {% include 'diagnostics/errors.html.twig' with {'errors': errors, 'warnings': warnings} %}
  {% include 'diagnostics/warnings.html.twig' with {'errors': errors, 'warnings': warnings} %}

{% endblock %}

{% block content %}

  {% if errors is empty %}

    <!-- Section (info) -->
    <div
      class="
        box
        kc__feed-loader__section
        kc__feed-loader__section_info">

      <div
        class="box-header">

        <div
          class="title">
          Загрузка фидов
        </div>

      </div>

      <div
        class="box-content">

        <div
          class="row box-section">

          Раздел позволяет наполнить сайт материалами, обновить
          уже имеющиеся данные, либо удалить новости, которые
          были созданы на основе фидов. Поведение функций данного
          раздела зависит от основных настроек модуля. Перед
          выполнением каких-либо операций рекомендуется сохранить
          резервную копию базы данных, так как обновление или
          удаление новостей невозможно будет отменить.

        </div>

        <div
          class="row box-section"
          style="padding-left: 0;">

          <div
            class="col-md-3">
            Лимит чтения материалов:
          </div>

          <div
            class="col-md-9">
            {{ feedLoaderPostsLimit ? feedLoaderPostsLimit : 'не ограничено' }}
          </div>

        </div>

        <div
          class="row box-section"
          style="padding-left: 0;">

          <div
            class="col-md-3">
            Назначение типов в категориях:
          </div>

          <div
            class="col-md-9">
            {{ categoriesFromVideoType ? 'да' : 'нет' }}
          </div>

        </div>

        <div
          class="row box-section"
          style="padding-left: 0;">

          <div
            class="col-md-3">
            Назначение жанров в категориях:
          </div>

          <div
            class="col-md-9">
            {{ categoriesFromVideoGenres ? 'да' : 'нет' }}
          </div>

        </div>

      </div>

    </div>

    <!-- Section (moonwalk) -->
    <div
      class="
        box
        kc__feed-loader__section
        kc__feed-loader__section_moonwalk">

      <div
        class="box-header">

        <div
          class="title">
          Фиды Moonwalk
        </div>

      </div>

      <div
        class="box-content">

        <div
          style="padding: 0;"
          class="row box-section">

          <div
            class="col-md-3"
            style="padding: 15px 15px 0 15px;">
            Используемые фиды:
          </div>

          <div
            class="col-md-9"
            style="padding: 15px;">

            {% if moonwalkFeeds is empty %}

              <span
                class="text-danger">
                фидов нет
              </span>

            {% else %}

              <div
                class="kc__tags">

                {% for feed in moonwalkFeeds %}

                  <span
                    class="kc__tag">
                    {{ feed.getLabel() }}
                  </span>

                {% endfor %}

              </div>

            {% endif %}

          </div>

        </div>

        <div
          class="row box-section">

          <div
            class="progress"
            style="margin: 10px 0;">

            <!-- Progress Bar (moonwalk) -->
            <div
              style="width: 0;"
              class="
                progress-bar
                progress-blue
                kc__feed-loader__progress-bar
                kc__feed-loader__progress-bar_moonwalk">

              <span></span>

            </div>

          </div>

        </div>

        <!-- Status Bar -->
        <div
          class="
            row box-section
            kc__feed-loader__status-bar">

          <div>

            <!-- Feed Posts Count (moonwalk) -->
            <span
              class="
                kc__feed-loader__feed-posts-count
                kc__feed-loader__feed-posts-count_moonwalk">
              {{ moonwalkFeedPostsCount }}
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              загружено
            </div>

          </div>

          <div>

            <!-- Feed Posts Updated (moonwalk) -->
            <span
              class="
                kc__feed-loader__feed-posts-updated
                kc__feed-loader__feed-posts-updated_moonwalk">
              0
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              обновлено
            </div>

          </div>

          <div>

            <!-- Feed Posts Skipped (moonwalk) -->
            <span
              class="
                kc__feed-loader__feed-posts-skipped
                kc__feed-loader__feed-posts-skipped_moonwalk">
              0
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              пропущено
            </div>

          </div>

        </div>

        <div
          class="row box-section"
          style="text-align: right;">

          <!-- Clean Posts Button (moonwalk) -->
          <button
            class="
              btn
              disabled
              btn-brown
              kc__feed-loader__clean-posts-button
              kc__feed-loader__clean-posts-button_moonwalk">
            Удалить загруженное
          </button>

          &nbsp

          <!-- Update Posts Button (moonwalk) -->
          <button
            class="
              btn
              disabled
              btn-blue
              kc__feed-loader__update-posts-button
              kc__feed-loader__update-posts-button_moonwalk">
            Начать обновление
          </button>

          &nbsp

          <!-- Create Posts Button (moonwalk) -->
          <button
            style="margin-bottom: 0;"
            class="
              btn
              disabled
              btn-green
              kc__feed-loader__create-posts-button
              kc__feed-loader__create-posts-button_moonwalk">
            Начать загрузку
          </button>

        </div>

      </div>

    </div>

    <!-- Section (kodik) -->
    <div
      class="
        box
        kc__feed-loader__section
        kc__feed-loader__section_kodik">

      <div
        class="box-header">

        <div
          class="title">
          Фиды Kodik
        </div>

      </div>

      <div
        class="box-content">

        <div
          style="padding: 0;"
          class="row box-section">

          <div
            class="col-md-3"
            style="padding: 15px 15px 0 15px;">
            Используемые фиды:
          </div>

          <div
            class="col-md-9"
            style="padding: 15px;">

            {% if kodikFeeds is empty %}

              <span
                class="text-danger">
                фидов нет
              </span>

            {% else %}

              <div
                class="kc__tags">

                {% for feed in kodikFeeds %}

                  <span
                    class="kc__tag">
                    {{ feed.getLabel() }}
                  </span>

                {% endfor %}

              </div>

            {% endif %}

          </div>

        </div>

        <div
          class="row box-section">

          <div
            class="progress"
            style="margin: 10px 0;">

            <!-- Progress Bar (kodik) -->
            <div
              style="width: 0;"
              class="
                progress-bar
                progress-blue
                kc__feed-loader__progress-bar
                kc__feed-loader__progress-bar_kodik">

              <span></span>

            </div>

          </div>

        </div>

        <!-- Status Bar -->
        <div
          class="
            row box-section
            kc__feed-loader__status-bar">

          <div>

            <!-- Feed Posts Count (kodik) -->
            <span
              class="
                kc__feed-loader__feed-posts-count
                kc__feed-loader__feed-posts-count_kodik">
              {{ kodikFeedPostsCount }}
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              загружено
            </div>

          </div>

          <div>

            <!-- Feed Posts Updated (kodik) -->
            <span
              class="
                kc__feed-loader__feed-posts-updated
                kc__feed-loader__feed-posts-updated_kodik">
              0
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              обновлено
            </div>

          </div>

          <div>

            <!-- Feed Posts Skipped (kodik) -->
            <span
              class="
                kc__feed-loader__feed-posts-skipped
                kc__feed-loader__feed-posts-skipped_kodik">
              0
            </span>

            <!-- Status Label -->
            <div
              class="kc__feed-loader__status-label">
              пропущено
            </div>

          </div>

        </div>

        <div
          class="row box-section"
          style="text-align: right;">

          <!-- Clean Posts Button (kodik) -->
          <button
            class="
              btn
              disabled
              btn-brown
              kc__feed-loader__clean-posts-button
              kc__feed-loader__clean-posts-button_kodik">
            Удалить загруженное
          </button>

          &nbsp

          <!-- Update Posts Button (kodik) -->
          <button
            class="
              btn
              disabled
              btn-blue
              kc__feed-loader__update-posts-button
              kc__feed-loader__update-posts-button_kodik">
            Начать обновление
          </button>

          &nbsp

          <!-- Create Posts Button (kodik) -->
          <button
            style="margin-bottom: 0;"
            class="
              btn
              disabled
              btn-green
              kc__feed-loader__create-posts-button
              kc__feed-loader__create-posts-button_kodik">
            Начать загрузку
          </button>

        </div>

      </div>

    </div>

    <div
      style="margin-bottom: 30px;">

      <a
        class="btn btn-lg btn-blue"
        href="{{ router.resolveUrl() }}">
        Вернуться
      </a>

    </div>

  {% else %}

    <div
      class="box">

      <div
        class="box-header">

        <div
          class="title">
          Раздел недоступен!
        </div>

      </div>

      <div
        class="row box-section">

        <!-- Section Message -->
        <div
          class="kc__section-message">

          <!-- Image of Section Message -->
          <img
            class="kc__section-message__image"
            src="/engine/modules/kinocomplete/web/assets/images/banners/fail-banner.png"/>

          <!-- Title of Section Message -->
          <div
            class="kc__section-message__title">
            Диагностика модуля оповестила об ошибках.
          </div>

          <p>
            Что бы восстановить функционал данного раздела,
            исправьте все ошибки указанные в начале страницы.
          </p>

        </div>

      </div>

      <div
        class="row box-section">

        <div
          class="col-md-12 text-center">

          <a
            class="btn btn btn-blue"
            href="{{ router.resolveUrl() }}">
            Вернуться назад
          </a>

        </div>

      </div>

    </div>

  {% endif %}

{% endblock %}

{% block assets %}

  <style>
    {{ source('feed-loader/style.css') }}
  </style>

  <script
    src="/engine/modules/kinocomplete/web/dist/injections/feed-loader.min.js">
  </script>

{% endblock %}
